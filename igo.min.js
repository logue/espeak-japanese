/**igo-javascript: Morphological analyzer for Javascript [ https://github.com/shogo82148/igo-javascript ] */(function(m){function a(a,b){return a<b}m=m.jsheap=function(c){this.cmp=c||a;this.heap=[null]};m.prototype.push=function(a){var b=this.heap,d=this.cmp,e=b.length,f;for(b.push(a);1<e&&d(b[e],b[f=e/2|0]);){a=b;var g=f,k=a[e];a[e]=a[g];a[g]=k;e=f}return this};m.prototype.top=function(){return this.heap[1]};m.prototype.pop=function(){if(this.empty())throw Error("heap is empty");var a=this.heap,b=this.cmp,d,e=a.pop(),f=a.length;if(1==f)return this;d=1;for(a[1]=e;2*d<f;){e=2*d;e+1<f&&b(a[e+1],a[e])&&++e;
if(!b(a[e],a[d]))break;var g=a,k=e,h=g[d];g[d]=g[k];g[k]=h;d=e}return this};m.prototype.empty=function(){return 1>=this.heap.length}})(this);var igo;
(function(m){"undefined"===typeof exports?igo={}:(igo=exports,jsheap=igo.jsheap);igo.Morpheme=function(a,c,b){this.surface=a;this.feature=c;this.start=b};igo.Tagger=function(a,c,b){this.wdc=a;this.unk=c;this.mtx=b};igo.Tagger.prototype={parse:function(a,c){c||(c=[]);for(var b=this.getBestPath(this.parseImpl(a));b;){var d=a.substring(b.start,b.start+b.length),e=this.wdc.wordData(b.wordId).join("");c.push(new igo.Morpheme(d,e,b.start));b=b.prev}return c},parseNBest:function(a,c,b){b||(b=[]);c=this.getNBestPath(this.parseImpl(a),
c);for(var d=0;d<c.length;++d){for(var e=c[d],f=[];e;){var g=e.node;if(0!=g.wordId){var k=a.substring(g.start,g.start+g.length),h=this.wdc.wordData(g.wordId).join("");f.push(new igo.Morpheme(k,h,g.start))}e=e.next}b.push(f)}return b},wakati:function(a,c){c||(c=[]);for(var b=this.getBestPath(this.parseImpl(a));b;){var d=a.substring(b.start,b.start+b.length);c.push(d);b=b.prev}return c},parseImpl:function(a){var c=a.length,b=Array(c+1),d=this.wdc,e=this.unk,f=this,g=new igo.MakeLattice(b,function(a,
b){return f.setMincostNode(a,b)}),k=function(a){g.call(a)};b[0]=[igo.ViterbiNode.makeBOSEOS()];k.isEmpty=function(){return g.isEmpty()};for(var h=0;h<c;h++)b[h]&&(g.set(h),d.search(a,h,k),e&&e.search(a,h,d,k));b[c+1]=[this.setMincostNode(igo.ViterbiNode.makeBOSEOS(),b[c])];return b},getBestPath:function(a){a=a[a.length-1][0].prev;for(var c=void 0;a.prev;){var b=a.prev;a.prev=c;c=a;a=b}return c},getNBestPath:function(a,c){var b=this.mtx,d=[],e=new jsheap(function(a,b){return a.predict_cost<b.predict_cost}),
f=a[a.length-1][0];for(e.push({node:f,cost:0,predict_cost:f.cost,next:void 0});!e.empty()&&d.length<c;){var f=e.top(),g=f.node.leftId,k=f.node.prevs;e.pop();if(0===f.node.wordId&&f.next)d.push(f);else for(var h=0;h<k.length;++h){var l=f.cost+b.linkCost(k[h].rightId,g)+f.node.nodecost;e.push({node:k[h],cost:l,predict_cost:l+k[h].cost,next:f})}}return d},setMincostNode:function(a,c){var b=this.mtx,d=a.leftId,e=c[0],e=e.cost+b.linkCost(e.rightId,d);a.prev=c[0];for(var f=1;f<c.length;f++){var g=c[f],
k=g.cost+b.linkCost(g.rightId,d);k<e&&(e=k,a.prev=g)}a.prevs=c;a.cost+=e;return a}};igo.MakeLattice=function(a,c){this.nodesAry=a;this.i=0;this.prevs=void 0;this.empty=!0;this.setMincostNode=c};igo.MakeLattice.prototype={set:function(a){this.i=a;this.prevs=this.nodesAry[a];this.nodesAry[a]=void 0;this.empty=!0},call:function(a){var c=this.nodesAry,b=this.i+a.length,d=c[b]||[];this.empty=!1;a.isSpace?d=d.concat(this.prevs):d.push(this.setMincostNode(a,this.prevs));c[b]=d},isEmpty:function(){return this.empty}};
igo.ViterbiNode=function(a,c,b,d,e,f,g){this.nodecost=this.cost=d;this.prev=void 0;this.prevs=[];this.wordId=a;this.start=c;this.length=b;this.leftId=e;this.rightId=f;this.isSpace=g};igo.ViterbiNode.makeBOSEOS=function(){return new igo.ViterbiNode(0,0,0,0,0,0,!1)};igo.CharCategory=function(a,c,b){a=new igo.ArrayBufferStream(a,b);this.categories=igo.CharCategory.readCategories(c,b);this.char2id=a.getIntArray(a.size()/4/2);this.eqlMasks=a.getIntArray(a.size()/4/2)};igo.CharCategory.prototype={category:function(a){return this.categories[this.char2id.get(a.charCodeAt(0))]},
isCompatible:function(a,c){return 0!=(this.eqlMasks.get(a.charCodeAt(0))&this.eqlMasks.get(c.charCodeAt(0)))}};igo.CharCategory.readCategories=function(a,c){for(var b=igo.getIntArray(a,c),d=b.length/4,e=[],f=0;f<d;f++)e.push(new igo.Category(b.get(4*f),b.get(4*f+1),1===b.get(4*f+2),1===b.get(4*f+3)));return e};igo.Category=function(a,c,b,d){this.id=a;this.length=c;this.invoke=b;this.group=d};igo.Unknown=function(a){this.category=a;this.spaceId=this.category.category(" ").id};igo.Unknown.prototype.search=
function(a,c,b,d){var e=this.category,f=a[c],g=e.category(f),k=a.length,h,l=g.id===this.spaceId,m=Math.min(k,g.length+c);if(d.isEmpty()||g.invoke){for(h=c;h<m;h++)if(b.searchFromTrieId(g.id,c,h-c+1,l,d),h+1!==m&&!e.isCompatible(f,a[h+1]))return;if(g.group&&m<k){for(h=m;h<k;h++)if(!e.isCompatible(f,a[h])){b.searchFromTrieId(g.id,c,h-c,l,d);return}b.searchFromTrieId(g.id,c,k-c,l,d)}}};igo.Matrix=function(a,c){var b=new igo.ArrayBufferStream(a,c);this.leftSize=b.getInt();this.rightSize=b.getInt();this.matrix=
b.getShortArray(this.leftSize*this.rightSize)};igo.Matrix.prototype.linkCost=function(a,c){return this.matrix.get(c*this.leftSize+a)};igo.WordDic=function(a,c,b,d,e){d=new igo.ArrayBufferStream(d,e);var f=d.size()/10;this.trie=new igo.Searcher(a,e);this.data=igo.getCharArray(c,e);this.indices=igo.getIntArray(b,e);this.dataOffsets=d.getIntArray(f);this.leftIds=d.getShortArray(f);this.rightIds=d.getShortArray(f);this.costs=d.getCharArray(f)};igo.WordDic.prototype={search:function(a,c,b){var d=this.costs,
e=this.leftIds,f=this.rightIds,g=this.indices;this.trie.eachCommonPrefix(a,c,function(a,c,l){var m=g.get(l+1);for(l=g.get(l);l<m;l++)b(new igo.ViterbiNode(l,a,c,d.get(l),e.get(l),f.get(l),!1))})},searchFromTrieId:function(a,c,b,d,e){var f=this.costs,g=this.leftIds,k=this.rightIds,h=this.indices.get(a+1);for(a=this.indices.get(a);a<h;a++)e(new igo.ViterbiNode(a,c,b,f.get(a),g.get(a),k.get(a),d))},wordData:function(a){var c=[],b=this.dataOffsets.get(a);for(a=this.dataOffsets.get(a+1);b<a;b++)c.push(String.fromCharCode(this.data.get(b)));
return c}};igo.Node={Base:{ID:function(a){return-a-1}},Chck:{TERMINATE_CODE:0,VACANT_CODE:1,CODE_LIMIT:65535}};igo.Node.Chck.TERMINATE_CHAR=String.fromCharCode(igo.Node.Chck.TERMINATE_CODE);igo.KeyStream=function(a,c){this.s=a;this.cur=c||0;this.len=a.length};igo.KeyStream.compare=function(a,c){var b=a.rest(),d=c.rest();return b<d?-1:b>d?1:0};igo.KeyStream.prototype={startsWith:function(a,c,b){var d=this.cur;return this.len-d<b?!1:this.s.substring(d,d+b)==a.substring(c,c+b)},rest:function(){return this.s.substring(this.cur)},
read:function(){if(this.eos())return igo.Node.Chck.TERMINATE_CHAR;var a=this.cur;this.cur+=1;return this.s.charAt(a)},eos:function(){return this.cur===this.len}};igo.Searcher=function(a,c){var b=new igo.ArrayBufferStream(a,c),d=b.getInt(),e=b.getInt(),f=b.getInt();this.keySetSize=e;this.begs=b.getIntArray(e);this.base=b.getIntArray(d);this.lens=b.getShortArray(e);this.chck=b.getCharArray(d);this.tail=b.getString(f)};igo.Searcher.prototype={size:function(){return this.keySetSize},search:function(a){var c=
this.base,b=this.chck,d=c.get(0);a=new KeyStream(a);for(var e=a.read();;){var f=d+e,d=c.get(f);if(b.get(f)==e)if(0<=d)continue;else if(a.eos()||this.keyExists(a,d))return igo.Node.Base.ID(d);return-1}},eachCommonPrefix:function(a,c,b){var d=this.base,e=this.chck,f=d.get(0),g=-1;for(a=new igo.KeyStream(a,c);;){var k=a.read().charCodeAt(0),h=f+igo.Node.Chck.TERMINATE_CODE,l=f+k;g++;if(e.get(h)==igo.Node.Chck.TERMINATE_CODE&&(b(c,g,igo.Node.Base.ID(d.get(h))),k==igo.Node.Chck.TERMINATE_CODE))break;f=
d.get(l);if(e.get(l)==k)if(0<=f)continue;else this.call_if_keyIncluding(a,f,c,g,b);break}},call_if_keyIncluding:function(a,c,b,d,e){c=igo.Node.Base.ID(c);a.startsWith(this.tail,this.begs.get(c),this.lens.get(c))&&e(b,d+this.lens.get(c)+1,c)},keyExists:function(a,c){var b=Node.Base.ID(c),d=this.begs.get(b),b=this.tail.substring(d,d+this.lens.get(b));return a.rest()===b}};igo.getServerFileToArrayBufffer=function(a,c){var b=new XMLHttpRequest;b.onreadystatechange=function(){b.readyState==b.DONE&&(200!=
b.status&&304!=b.status||!b.response?alert("Failed to download:"+b.status+" "+b.statusText):c(b.response))};b.open("GET",a,!0);b.responseType="arraybuffer";b.send();return b};igo.IntArray=function(a,c,b,d){this.buffer=a;this.pos=c;this.length=b;this.bigendian=d};igo.IntArray.readUInt=function(a,c,b){return igo.IntArray.readInt(a,c,b)>>>0};igo.IntArray.readInt=function(a,c,b){var d=0;return d=b?a[c]<<24|a[c+1]<<16|a[c+2]<<8|a[c+3]:a[c+3]<<24|a[c+2]<<16|a[c+1]<<8|a[c]};igo.IntArray.prototype={get:function(a){return igo.IntArray.readInt(this.buffer,
this.pos+4*a,this.bigendian)}};igo.ShortArray=function(a,c,b,d){this.buffer=a;this.pos=c;this.length=b;this.bigendian=d};igo.ShortArray.readUShort=function(a,c,b){var d=0;return d=b?a[c]<<8|a[c+1]:a[c+1]<<8|a[c]};igo.ShortArray.readShort=function(a,c,b){a=igo.ShortArray.readUShort(a,c,b);32768<=a&&(a-=65536);return a};igo.ShortArray.prototype={get:function(a){return igo.ShortArray.readShort(this.buffer,this.pos+2*a,this.bigendian)}};igo.CharArray=function(a,c,b,d){this.buffer=a;this.pos=c;this.length=
b;this.bigendian=d};igo.CharArray.prototype={get:function(a){return igo.ShortArray.readUShort(this.buffer,this.pos+2*a,this.bigendian)}};igo.ArrayBufferStream=function(a,c){this.buffer="ArrayBuffer"===typeof a?new Uint8Array(a):a;this.bigendian=c;this.pos=0};igo.ArrayBufferStream.prototype={getInt:function(){var a=igo.IntArray.readInt(this.buffer,this.pos,this.bigendian);this.pos+=4;return a},getIntArray:function(a){var c=new igo.IntArray(this.buffer,this.pos,a,this.bigendian);this.pos+=4*a;return c},
getShortArray:function(a){var c=new igo.ShortArray(this.buffer,this.pos,a,this.bigendian);this.pos+=2*a;return c},getCharArray:function(a){var c=new igo.CharArray(this.buffer,this.pos,a,this.bigendian);this.pos+=2*a;return c},getString:function(a){for(var c=new igo.CharArray(this.buffer,this.pos,a,this.bigendian),b="",d=0;d<a;d++)b+=String.fromCharCode(c.get(d));this.pos+=2*a;return b},size:function(){return this.buffer.length}};igo.getIntArray=function(a,c){var b=new igo.ArrayBufferStream(a,c);return b.getIntArray(b.size()/
4)};igo.getCharArray=function(a,c){var b=new igo.ArrayBufferStream(a,c);return b.getCharArray(b.size()/2)}})(this);
